```ruby
class Segtree
  def initialize(size, id, fill = id, &op)
    if size.is_a? Array
      @n = 1 << (size.size - 1).bit_length
      @a = [fill] * (2 * @n)
      @a[@n, @n] = size
      (@n - 1).downto(1) do |i|
        @a[i] = op[@a[i * 2], @a[i * 2 + 1]]
      end
    else
      @n = 1 << (size - 1).bit_length
      @a = [fill] * (2 * @n)
    end
    @a[0], @op = id, op
  end
  def [](i) @a[i + @n] end
  def []=(i, x)
    @a[i += @n] = x
    @a[i] = @op[@a[i * 2], @a[i * 2 + 1]] while (i >>= 1) > 0
  end
  def prod(l, r)
    return @a[0] if l >= r
    x = prod(l + 1 >> 1, r >> 1)
    x = @op[@a[@n + l], x] if l & 1 == 1
    x = @op[x, @a[@n + r - 1]] if r & 1 == 1
    x
  end
end
```
